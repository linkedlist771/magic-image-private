(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4204:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ew});var s=a(5155),r=a(2115),n=a(2596),l=a(9688);function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,l.QP)((0,n.$)(t))}function o(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card",className:i("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function c(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-header",className:i("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function d(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-content",className:i("px-6",t),...a})}var u=a(9708);let m=(0,a(2085).F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function h(e){let{className:t,variant:a,size:r,asChild:n=!1,...l}=e,o=n?u.DX:"button";return(0,s.jsx)(o,{"data-slot":"button",className:i(m({variant:a,size:r,className:t})),...l})}function g(e){let{className:t,...a}=e;return(0,s.jsx)("textarea",{"data-slot":"textarea",className:i("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...a})}var x=a(1146),p=a(6474),f=a(5196),v=a(7863);function j(e){let{...t}=e;return(0,s.jsx)(x.bL,{"data-slot":"select",...t})}function b(e){let{...t}=e;return(0,s.jsx)(x.WT,{"data-slot":"select-value",...t})}function y(e){let{className:t,size:a="default",children:r,...n}=e;return(0,s.jsxs)(x.l9,{"data-slot":"select-trigger","data-size":a,className:i("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n,children:[r,(0,s.jsx)(x.In,{asChild:!0,children:(0,s.jsx)(p.A,{className:"size-4 opacity-50"})})]})}function w(e){let{className:t,children:a,position:r="popper",...n}=e;return(0,s.jsx)(x.ZL,{children:(0,s.jsxs)(x.UC,{"data-slot":"select-content",className:i("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...n,children:[(0,s.jsx)(A,{}),(0,s.jsx)(x.LM,{className:i("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),(0,s.jsx)(I,{})]})})}function N(e){let{className:t,children:a,...r}=e;return(0,s.jsxs)(x.q7,{"data-slot":"select-item",className:i("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...r,children:[(0,s.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,s.jsx)(x.VF,{children:(0,s.jsx)(f.A,{className:"size-4"})})}),(0,s.jsx)(x.p4,{children:a})]})}function A(e){let{className:t,...a}=e;return(0,s.jsx)(x.PP,{"data-slot":"select-scroll-up-button",className:i("flex cursor-default items-center justify-center py-1",t),...a,children:(0,s.jsx)(v.A,{className:"size-4"})})}function I(e){let{className:t,...a}=e;return(0,s.jsx)(x.wn,{"data-slot":"select-scroll-down-button",className:i("flex cursor-default items-center justify-center py-1",t),...a,children:(0,s.jsx)(p.A,{className:"size-4"})})}var C=a(1284),S=a(381),E=a(9676),k=a(1497),L=a(7213),O=a(9869),P=a(1788),D=a(3717),z=a(2355),_=a(3052),M=a(6766),T=a(237),R=a(4416);function U(e){let{...t}=e;return(0,s.jsx)(T.bL,{"data-slot":"dialog",...t})}function G(e){let{...t}=e;return(0,s.jsx)(T.ZL,{"data-slot":"dialog-portal",...t})}function H(e){let{className:t,...a}=e;return(0,s.jsx)(T.hJ,{"data-slot":"dialog-overlay",className:i("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function J(e){let{className:t,children:a,...r}=e;return(0,s.jsxs)(G,{"data-slot":"dialog-portal",children:[(0,s.jsx)(H,{}),(0,s.jsxs)(T.UC,{"data-slot":"dialog-content",className:i("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...r,children:[a,(0,s.jsxs)(T.bm,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,s.jsx)(R.A,{}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function F(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-header",className:i("flex flex-col gap-2 text-center sm:text-left",t),...a})}function q(e){let{className:t,...a}=e;return(0,s.jsx)(T.hE,{"data-slot":"dialog-title",className:i("text-lg leading-none font-semibold",t),...a})}let V=r.forwardRef((e,t)=>{let{className:a,type:r,...n}=e;return(0,s.jsx)("input",{type:r,className:i("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...n})});V.displayName="Input";let B="https://newapi.585dg.com",K={API_CONFIG:"ai-drawing-api-config",HISTORY:"ai-drawing-history",CUSTOM_MODELS:"ai-drawing-custom-models",LAST_SELECTED_MODEL:"ai-drawing-last-selected-model"},W={getApiConfig:()=>{let e=localStorage.getItem(K.API_CONFIG),t=e?JSON.parse(e):null;return t&&(t.baseUrl=B),t},setApiConfig:(e,t)=>{let a={key:e,baseUrl:B,createdAt:new Date().toISOString()};localStorage.setItem(K.API_CONFIG,JSON.stringify(a))},removeApiConfig:()=>{localStorage.removeItem(K.API_CONFIG)},getHistory:()=>{let e=localStorage.getItem(K.HISTORY);return e?JSON.parse(e):[]},addToHistory:e=>{let t=W.getHistory();t.unshift(e),localStorage.setItem(K.HISTORY,JSON.stringify(t))},clearHistory:()=>{localStorage.removeItem(K.HISTORY)},removeFromHistory:e=>{let t=W.getHistory().filter(t=>t.id!==e);localStorage.setItem(K.HISTORY,JSON.stringify(t))},getCustomModels:()=>{let e=localStorage.getItem(K.CUSTOM_MODELS);return e?JSON.parse(e):[]},addCustomModel:e=>{let t=W.getCustomModels();t.push(e),localStorage.setItem(K.CUSTOM_MODELS,JSON.stringify(t))},removeCustomModel:e=>{let t=W.getCustomModels().filter(t=>t.id!==e);localStorage.setItem(K.CUSTOM_MODELS,JSON.stringify(t))},updateCustomModel:(e,t)=>{let a=W.getCustomModels(),s=a.findIndex(t=>t.id===e);-1!==s&&(a[s]={...a[s],...t},localStorage.setItem(K.CUSTOM_MODELS,JSON.stringify(a)))},getLastSelectedModel:()=>localStorage.getItem(K.LAST_SELECTED_MODEL),setLastSelectedModel:e=>{localStorage.setItem(K.LAST_SELECTED_MODEL,e)}};var Y=a(8749),X=a(2657),Q=a(6671);let Z="https://newapi.585dg.com";function $(e){let{open:t,onOpenChange:a}=e,[n,l]=(0,r.useState)(""),[i,o]=(0,r.useState)(""),[c,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)({});(0,r.useEffect)(()=>{let e=W.getApiConfig();e&&l(e.key),o(Z)},[t]);let g=()=>{let e={};return n.trim()||(e.key="请输入 API Key"),m(e),0===Object.keys(e).length};return(0,s.jsx)(U,{open:t,onOpenChange:a,children:(0,s.jsxs)(J,{children:[(0,s.jsx)(F,{children:(0,s.jsx)(q,{children:"API 配置"})}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(V,{placeholder:"API基础地址（固定）",value:i,readOnly:!0,className:"bg-gray-50 cursor-not-allowed"}),(0,s.jsx)("div",{className:"flex flex-col gap-1 mt-1",children:(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["API地址已固定为：",Z]})})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(V,{type:c?"text":"password",placeholder:"请输入您的 API Key",value:n,onChange:e=>{l(e.target.value),m(e=>({...e,key:void 0}))},className:"pr-10 ".concat(u.key?"border-red-500":"")}),(0,s.jsx)(h,{variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3",onClick:()=>d(!c),children:c?(0,s.jsx)(Y.A,{className:"h-4 w-4"}):(0,s.jsx)(X.A,{className:"h-4 w-4"})}),u.key&&(0,s.jsx)("p",{className:"text-sm text-red-500 mt-1",children:u.key})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"API 配置将安全地存储在您的浏览器中，不会上传到服务器"})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(h,{variant:"outline",onClick:()=>a(!1),children:"取消"}),(0,s.jsx)(h,{onClick:()=>{g()&&(W.setApiConfig(n.trim(),Z),Q.o.success("保存成功"),a(!1))},children:"保存"})]})]})]})})}var ee=a(2525);function et(e){let{open:t,onOpenChange:a,onEditImage:n}=e,[l,i]=(0,r.useState)([]);(0,r.useEffect)(()=>{t&&i(W.getHistory())},[t]);let o=e=>{W.removeFromHistory(e),i(W.getHistory())},c=async e=>{try{let t=await fetch(e),a=await t.blob(),s=window.URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download="generated-image.png",document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(s)}catch(e){console.error("下载失败:",e)}},d=e=>{n(e.url),a(!1)};return(0,s.jsx)(U,{open:t,onOpenChange:a,children:(0,s.jsxs)(J,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[(0,s.jsx)(F,{children:(0,s.jsx)(q,{children:"生成历史"})}),0===l.length?(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:"暂无生成记录"}):(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 p-4",children:l.map(e=>(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("div",{className:"aspect-square relative overflow-hidden rounded-lg",children:(0,s.jsx)(M.default,{src:e.url,alt:e.prompt,fill:!0,className:"object-cover"})}),(0,s.jsxs)("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[(0,s.jsx)(h,{size:"icon",variant:"ghost",className:"text-white hover:text-white hover:bg-white/20",onClick:()=>c(e.url),children:(0,s.jsx)(P.A,{className:"h-5 w-5"})}),(0,s.jsx)(h,{size:"icon",variant:"ghost",className:"text-white hover:text-white hover:bg-white/20",onClick:()=>d(e),children:(0,s.jsx)(D.A,{className:"h-5 w-5"})}),(0,s.jsx)(h,{size:"icon",variant:"ghost",className:"text-white hover:text-white hover:bg-white/20",onClick:()=>o(e.id),children:(0,s.jsx)(ee.A,{className:"h-5 w-5"})})]}),(0,s.jsxs)("div",{className:"mt-2 text-sm",children:[(0,s.jsx)("p",{className:"text-gray-700 line-clamp-2",children:e.prompt}),(0,s.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:new Date(e.createdAt).toLocaleString()})]})]},e.id))})]})})}var ea=function(e){return e.DALLE="dalle",e.OPENAI="openai",e.GEMINI="gemini",e}({});let es=e=>{Q.o.error(e,{style:{color:"#EF4444"},duration:5e3})},er=(e,t)=>e.endsWith("#")?e.slice(0,-1):"".concat(e).concat(t),en={generateDalleImage:async e=>{let t=W.getApiConfig();if(!t)throw es("请先设置 API 配置"),Error("请先设置 API 配置");if(!t.key||!t.baseUrl)throw es("API 配置不完整，请检查 API Key 和基础地址"),Error("API 配置不完整");let a=((e.modelType||ea.DALLE)===ea.DALLE,"/v1/images/generations"),s=er(t.baseUrl,a),r=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.key)},body:JSON.stringify({model:e.model,prompt:e.prompt,size:e.size||"auto",n:e.n||1,quality:e.quality})});if(!r.ok){var n,l;let e=await r.json(),t=e.message||(null==(n=e.error)?void 0:n.message)||"生成图片失败",a=e.code||(null==(l=e.error)?void 0:l.code),s="".concat(t).concat(a?"\n错误代码: ".concat(a):"");throw es(s),Error(s)}return r.json()},editDalleImage:async e=>{let t=W.getApiConfig();if(!t)throw es("请先设置 API 配置"),Error("请先设置 API 配置");if(!t.key||!t.baseUrl)throw es("API 配置不完整，请检查 API Key 和基础地址"),Error("API 配置不完整");if(!e.sourceImage)throw es("请先上传图片"),Error("请先上传图片");try{let r=((e.modelType||ea.DALLE)===ea.DALLE,"/v1/images/edits"),n=new FormData;n.append("prompt",e.prompt),console.log(e.sourceImage);let l=await fetch(e.sourceImage);if(!l.ok)throw Error("获取源图片失败");let i=await l.blob();if(n.append("image",i,"image.png"),e.mask){console.log(e.mask);let t=await fetch(e.mask);if(!t.ok)throw Error("获取遮罩图片失败");let a=await t.blob();n.append("mask",a,"mask.png")}n.append("model",e.model),e.size&&n.append("size",e.size),e.n&&n.append("n",e.n.toString()),e.quality&&n.append("quality",e.quality);let o=er(t.baseUrl,r),c=await fetch(o,{method:"POST",headers:{Authorization:"Bearer ".concat(t.key)},body:n});if(!c.ok){var a,s;let e=await c.json(),t=e.message||(null==(a=e.error)?void 0:a.message)||"编辑图片失败",r=e.code||(null==(s=e.error)?void 0:s.code),n="".concat(t).concat(r?"\n错误代码: ".concat(r):"");throw es(n),Error(n)}return c.json()}catch(t){if(t instanceof Error)throw es(t.message),t;let e="编辑图片失败";throw es(e),Error(e)}},generateGeminiImage:async e=>{let t=W.getApiConfig();if(!t)throw es("请先设置 API 配置"),Error("请先设置 API 配置");if(!t.key||!t.baseUrl)throw es("API 配置不完整，请检查 API Key 和基础地址"),Error("API 配置不完整");let a=er(t.baseUrl,"/v1beta/models/".concat(e.model,":generateContent")),s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.key)},body:JSON.stringify({contents:[{parts:[{text:"请帮我画图：".concat(e.prompt)}]}],generationConfig:{responseModalities:["TEXT","IMAGE"]}})});if(!s.ok){var r,n;let e=await s.json(),t=e.message||(null==(r=e.error)?void 0:r.message)||"生成图片失败",a=e.code||(null==(n=e.error)?void 0:n.code),l="".concat(t).concat(a?"\n错误代码: ".concat(a):"");throw es(l),Error(l)}let l=await s.json(),i=[],o="";if(l.candidates&&l.candidates.length>0){let e=l.candidates[0];e.content&&e.content.parts&&e.content.parts.forEach(e=>{if(e.inlineData&&e.inlineData.data||e.inline_data&&e.inline_data.data){var t,a;let s=(null==(t=e.inlineData)?void 0:t.data)||(null==(a=e.inline_data)?void 0:a.data);i.push({b64_json:s})}e.text&&(o+=String(e.text))})}if(0===i.length){let e=(null==o?void 0:o.trim())?"Gemini未返回图片：".concat(o.trim()):"Gemini未返回图片";throw es(e),Error(e)}return{data:i}},editGeminiImage:async e=>{let t=W.getApiConfig();if(!t)throw es("请先设置 API 配置"),Error("请先设置 API 配置");if(!t.key||!t.baseUrl)throw es("API 配置不完整，请检查 API Key 和基础地址"),Error("API 配置不完整");if(!e.sourceImage)throw es("请先上传图片"),Error("请先上传图片");try{let r=er(t.baseUrl,"/v1beta/models/".concat(e.model,":generateContent")),n=e.sourceImage.split(",")[1],l=atob(n),i=new Uint8Array(l.length);for(let e=0;e<l.length;e++)i[e]=l.charCodeAt(e);let o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.key)},body:JSON.stringify({contents:[{parts:[{text:"请帮我画图：".concat(e.prompt)},{inline_data:{mime_type:"image/png",data:n}}]}],generationConfig:{responseModalities:["TEXT","IMAGE"]}})});if(!o.ok){var a,s;let e=await o.json(),t=e.message||(null==(a=e.error)?void 0:a.message)||"编辑图片失败",r=e.code||(null==(s=e.error)?void 0:s.code),n="".concat(t).concat(r?"\n错误代码: ".concat(r):"");throw es(n),Error(n)}let c=await o.json(),d=[],u="";if(c.candidates&&c.candidates.length>0){let e=c.candidates[0];e.content&&e.content.parts&&e.content.parts.forEach(e=>{if(e.inlineData&&e.inlineData.data||e.inline_data&&e.inline_data.data){var t,a;let s=(null==(t=e.inlineData)?void 0:t.data)||(null==(a=e.inline_data)?void 0:a.data);d.push({b64_json:s})}e.text&&(u+=String(e.text))})}if(0===d.length){let e=(null==u?void 0:u.trim())?"Gemini未返回图片：".concat(u.trim()):"Gemini未返回图片";throw es(e),Error(e)}return{data:d}}catch(t){if(t instanceof Error)throw es(t.message),t;let e="编辑图片失败";throw es(e),Error(e)}},generateStreamImage:async(e,t)=>{var a,s,r,n,l,i,o,c,d;let u=W.getApiConfig();if(!u){let e="请先设置 API 配置";es(e),t.onError(e);return}if(!u.key||!u.baseUrl){let e="API 配置不完整，请检查 API Key 和基础地址";es(e),t.onError(e);return}let m=e.isImageToImage?[{role:"user",content:[{type:"text",text:e.prompt},...Array.isArray(e.sourceImages)?e.sourceImages.map(e=>({type:"image_url",image_url:{url:e}})):e.sourceImage?[{type:"image_url",image_url:{url:e.sourceImage}}]:[]]}]:[{role:"user",content:e.prompt}],h=e.modelType||ea.OPENAI,g=h===ea.DALLE?"/v1/images/generations":"/v1/chat/completions",x=h===ea.DALLE?{model:e.model,prompt:e.prompt,size:"1:1"===e.aspectRatio?"1024x1024":"16:9"===e.aspectRatio?"1792x1024":"1024x1792",n:1}:{model:e.model,messages:m,stream:!0},p=er(u.baseUrl,g),f=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(u.key)},body:JSON.stringify(x)});if(!f.ok){try{let e=await f.json(),a=e.message||(null==(s=e.error)?void 0:s.message)||"生成图片失败",n=e.code||(null==(r=e.error)?void 0:r.code),l="".concat(a).concat(n?"\n错误代码: ".concat(n):"");t.onError(l),es(l)}catch(a){let e="生成图片失败";t.onError(e),es(e)}return}let v=null==(a=f.body)?void 0:a.getReader();if(!v)return void t.onError("读取响应失败");let j=new TextDecoder,b="";try{for(;;){let{done:e,value:a}=await v.read();if(e)break;let s=(b+=j.decode(a,{stream:!0})).split("\n");for(let e of(b=s.pop()||"",s)){let a=e.trim();if(a&&"data: [DONE]"!==a)try{let e=a.replace(/^data: /,""),s=JSON.parse(e);if(null==(i=s.choices)||null==(l=i[0])||null==(n=l.delta)?void 0:n.content){let e=s.choices[0].delta.content;t.onMessage(e);let a=e.match(/\[.*?\]\((.*?)\)/);if(a&&a[1])return void t.onComplete(a[1])}}catch(e){console.warn("解析数据行失败:",e)}}}if(b.trim())try{let e=b.trim().replace(/^data: /,""),a=JSON.parse(e);if(null==(d=a.choices)||null==(c=d[0])||null==(o=c.delta)?void 0:o.content){let e=a.choices[0].delta.content;t.onMessage(e);let s=e.match(/\[.*?\]\((.*?)\)/);s&&s[1]&&t.onComplete(s[1])}}catch(e){console.warn("解析最后的数据失败:",e)}}catch(e){console.error("处理流数据失败:",e),t.onError("处理响应数据失败")}v.releaseLock()}};var el=a(1368),ei=a(5904),eo=a(3104),ec=a(3654),ed=a(8932),eu=a(133),em=a(1154),eh=a(4073);let eg=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsxs)(eh.bL,{ref:t,className:i("relative flex w-full touch-none select-none items-center",a),...r,children:[(0,s.jsx)(eh.CC,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:(0,s.jsx)(eh.Q6,{className:"absolute h-full bg-primary"})}),(0,s.jsx)(eh.zi,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]})});function ex(e){let{imageUrl:t,onMaskChange:a,onClose:n,initialMask:l}=e,i=(0,r.useRef)(null),o=(0,r.useRef)(null),[c,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),[g,x]=(0,r.useState)(!0),p=(0,r.useRef)(null),[f,v]=(0,r.useState)(30),j=(0,r.useRef)(null),[b,y]=(0,r.useState)(.4),w=(0,r.useRef)([]),N=(0,r.useRef)(-1),A=()=>{let e=o.current;if(!e)return;let t=w.current.slice(0,N.current+1);t.push(e.toDataURL()),w.current=t,N.current=t.length-1},I=()=>{let e=o.current,t=null==e?void 0:e.getContext("2d");if(!e||!t)return;let a=new Image;a.onload=()=>{t.clearRect(0,0,e.width,e.height),t.drawImage(a,0,0),S()},a.src=w.current[N.current]};(0,r.useEffect)(()=>{let e=i.current,a=o.current;if(!e||!a)return;let s=e.getContext("2d"),r=a.getContext("2d");if(!s||!r)return;x(!0);let n=new window.Image;n.crossOrigin="anonymous",n.onload=()=>{if(e.width=n.width,e.height=n.height,a.width=n.width,a.height=n.height,j.current=n,s.drawImage(n,0,0),l){let e=new Image;e.onload=()=>{r.drawImage(e,0,0),A(),S(),x(!1)},e.src=l}else r.fillStyle="black",r.fillRect(0,0,a.width,a.height),A(),S(),x(!1)},n.src=t},[t,l]);let C=e=>{let t=document.createElement("canvas");t.width=20,t.height=20;let a=t.getContext("2d");if(a){a.fillStyle="rgba(255, 255, 255, ".concat(b,")"),a.fillRect(0,0,20,20),a.strokeStyle="rgba(255, 255, 255, ".concat(.8*b,")"),a.lineWidth=.5;for(let e=0;e<=20;e+=5)a.beginPath(),a.moveTo(e,0),a.lineTo(e,20),a.stroke();for(let e=0;e<=20;e+=5)a.beginPath(),a.moveTo(0,e),a.lineTo(20,e),a.stroke();return e.createPattern(t,"repeat")}},S=()=>{let e=i.current,t=o.current;if(!e||!t||!j.current)return;let a=e.getContext("2d"),s=t.getContext("2d");if(!a||!s)return;a.clearRect(0,0,e.width,e.height),a.drawImage(j.current,0,0);let r=s.getImageData(0,0,t.width,t.height),n=C(a);if(!n)return;let l=document.createElement("canvas");l.width=e.width,l.height=e.height;let c=l.getContext("2d");if(c){c.fillStyle=n;for(let e=0;e<r.data.length;e+=4)if(255===r.data[e]){let a=e/4%t.width,s=Math.floor(e/4/t.width);c.fillRect(a,s,1,1)}a.drawImage(l,0,0)}},E=e=>{let t,a,s=i.current,r=o.current;if(!s||!r||!c)return;let n=r.getContext("2d");if(!n)return;let l=s.getBoundingClientRect(),d=s.width/l.width,m=s.height/l.height;e instanceof MouseEvent?(t=(e.clientX-l.left)*d,a=(e.clientY-l.top)*m):(t=(e.touches[0].clientX-l.left)*d,a=(e.touches[0].clientY-l.top)*m),p.current&&(n.beginPath(),n.moveTo(p.current.x,p.current.y),n.lineTo(t,a),n.strokeStyle=u?"black":"white",n.lineWidth=f,n.lineCap="round",n.lineJoin="round",n.stroke(),S()),p.current={x:t,y:a}},k=e=>{d(!0),p.current=null,E(e.nativeEvent)},L=()=>{c&&(d(!1),p.current=null,A())};return(0,s.jsx)("div",{className:"fixed inset-0 z-50 bg-background/80 backdrop-blur-sm",children:(0,s.jsx)("div",{className:"fixed left-[50%] top-[50%] z-50 grid w-full max-w-4xl translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 sm:rounded-lg",children:(0,s.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"编辑区域"}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"笔刷大小"}),(0,s.jsx)(eg,{value:[f],onValueChange:e=>v(e[0]),min:5,max:100,step:1,className:"w-24"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"网格透明度"}),(0,s.jsx)(eg,{value:[100*b],onValueChange:e=>{y(e[0]/100),S()},min:10,max:80,step:1,className:"w-24"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(h,{variant:u?"outline":"default",size:"icon",onClick:()=>m(!1),children:(0,s.jsx)(ei.A,{className:"h-4 w-4"})}),(0,s.jsx)(h,{variant:u?"default":"outline",size:"icon",onClick:()=>m(!0),children:(0,s.jsx)(eo.A,{className:"h-4 w-4"})}),(0,s.jsx)(h,{variant:"outline",size:"icon",onClick:()=>{N.current>0&&(N.current--,I())},disabled:N.current<=0,children:(0,s.jsx)(ec.A,{className:"h-4 w-4"})}),(0,s.jsx)(h,{variant:"outline",size:"icon",onClick:()=>{N.current<w.current.length-1&&(N.current++,I())},disabled:N.current>=w.current.length-1,children:(0,s.jsx)(ed.A,{className:"h-4 w-4"})}),(0,s.jsx)(h,{variant:"outline",size:"icon",onClick:()=>{let e=o.current,t=null==e?void 0:e.getContext("2d");e&&t&&(t.fillStyle="black",t.fillRect(0,0,e.width,e.height),A(),S())},children:(0,s.jsx)(eu.A,{className:"h-4 w-4"})})]})]})]}),(0,s.jsxs)("div",{className:"relative border rounded-lg overflow-hidden",children:[g&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-background/50",children:(0,s.jsx)(em.A,{className:"h-8 w-8 animate-spin text-primary"})}),(0,s.jsx)("canvas",{ref:i,className:"w-full h-full touch-none",onMouseDown:k,onMouseMove:e=>{c&&E(e.nativeEvent)},onMouseUp:L,onMouseLeave:L,onTouchStart:k,onTouchMove:e=>{c&&(e.preventDefault(),E(e.nativeEvent))},onTouchEnd:L}),(0,s.jsx)("canvas",{ref:o,className:"absolute top-0 left-0 opacity-0 pointer-events-none"})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(h,{variant:"outline",onClick:n,children:"取消"}),(0,s.jsx)(h,{onClick:()=>{let e=o.current;e&&(a(e.toDataURL("image/png")),n())},children:"确认"})]})]})})})}eg.displayName=eh.bL.displayName;var ep=a(5695),ef=a(8240),ev=a(4823),ej=a(3161),eb=a(4616);function ey(e){let{open:t,onOpenChange:a,onSelectModel:n}=e,[l,i]=(0,r.useState)([]),[o,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(""),[m,g]=(0,r.useState)(ea.OPENAI),[x,p]=(0,r.useState)(null);(0,r.useEffect)(()=>{t&&i(W.getCustomModels())},[t]);let f=()=>{c(""),u(""),g(ea.OPENAI),p(null)},v=e=>{c(e.name),u(e.value),g(e.type),p(e.id)},A=e=>{W.removeCustomModel(e),i(t=>t.filter(t=>t.id!==e)),Q.o.success("模型已删除")},I=e=>{n&&(n(e.value,e.type),a(!1))};return(0,s.jsx)(U,{open:t,onOpenChange:a,children:(0,s.jsxs)(J,{className:"sm:max-w-[500px]",children:[(0,s.jsx)(F,{children:(0,s.jsx)(q,{children:"自定义模型管理"})}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"text-sm font-medium",children:"添加/编辑模型"}),(0,s.jsxs)("div",{className:"grid gap-3",children:[(0,s.jsx)("div",{children:(0,s.jsx)(V,{placeholder:"模型名称（显示在界面上）",value:o,onChange:e=>c(e.target.value)})}),(0,s.jsx)("div",{children:(0,s.jsx)(V,{placeholder:"模型值（实际API使用的值）",value:d,onChange:e=>u(e.target.value)})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(j,{value:m,onValueChange:e=>g(e),children:[(0,s.jsx)(y,{children:(0,s.jsx)(b,{placeholder:"选择模型类型"})}),(0,s.jsxs)(w,{children:[(0,s.jsx)(N,{value:ea.DALLE,children:"DALL-E 格式"}),(0,s.jsx)(N,{value:ea.OPENAI,children:"OpenAI 格式"}),(0,s.jsx)(N,{value:ea.GEMINI,children:"Gemini 格式"})]})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"DALL-E格式：使用图像生成接口 | OpenAI格式：使用聊天接口 | Gemini格式：使用Gemini图像生成接口"})]}),(0,s.jsx)(h,{onClick:()=>{if(!o.trim()||!d.trim())return void Q.o.error("模型名称和值不能为空");if(l.some(e=>e.id!==x&&(e.value.toLowerCase()===d.trim().toLowerCase()||e.name.toLowerCase()===o.trim().toLowerCase())))return void Q.o.error("已存在相同名称或相同值的模型，请使用不同的名称或值");let e={id:x||(0,el.A)(),name:o.trim(),value:d.trim(),type:m,createdAt:new Date().toISOString()};x?(W.updateCustomModel(x,e),i(t=>t.map(t=>t.id===x?e:t)),Q.o.success("模型已更新")):(W.addCustomModel(e),i(t=>[...t,e]),Q.o.success("模型已添加")),f()},children:x?"更新模型":"添加模型"}),x&&(0,s.jsx)(h,{variant:"ghost",onClick:f,children:"取消编辑"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"text-sm font-medium",children:"已保存的模型"}),0===l.length?(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"尚未添加自定义模型"}):(0,s.jsx)("div",{className:"space-y-2",children:l.map(e=>(0,s.jsxs)("div",{className:"border rounded-md p-3 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium truncate",children:e.name}),(0,s.jsx)("p",{className:"text-xs text-gray-500 truncate",children:e.value}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["类型: ",e.type===ea.DALLE?"DALL-E":"OpenAI"]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(h,{size:"icon",variant:"ghost",onClick:()=>I(e),children:(0,s.jsx)(eb.A,{className:"h-4 w-4"})}),(0,s.jsx)(h,{size:"icon",variant:"ghost",onClick:()=>v(e),children:(0,s.jsx)(D.A,{className:"h-4 w-4"})}),(0,s.jsx)(h,{size:"icon",variant:"ghost",onClick:()=>A(e.id),children:(0,s.jsx)(ee.A,{className:"h-4 w-4"})})]})]},e.id))})]})]})]})})}function ew(){return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)("div",{children:"Loading..."}),children:(0,s.jsx)(eN,{})})}function eN(){let[e,t]=(0,r.useState)(!1),[a,n]=(0,r.useState)(!1),[l,i]=(0,r.useState)(!1),[u,m]=(0,r.useState)(""),[x,p]=(0,r.useState)(()=>W.getLastSelectedModel()||"gemini-2.5-flash-imagen"),[f,v]=(0,r.useState)(ea.OPENAI),[A,I]=(0,r.useState)(!1),[T,R]=(0,r.useState)([]),[G,H]=(0,r.useState)(0),[F,q]=(0,r.useState)(!1),[V,B]=(0,r.useState)(null),[K,Y]=(0,r.useState)(""),[X,Z]=(0,r.useState)(!1),[ee,es]=(0,r.useState)([]),[er,ei]=(0,r.useState)("1:1"),[eo,ec]=(0,r.useState)("1024x1024"),[ed,eu]=(0,r.useState)(1),[em,eh]=(0,r.useState)("auto"),eg=(0,r.useRef)(null),eb=(0,r.useRef)(null),[ew,eN]=(0,r.useState)(!1),[eA,eI]=(0,r.useState)(null),[eC,eS]=(0,r.useState)(!1),[eE,ek]=(0,r.useState)(null),eL=(0,ep.useSearchParams)();(0,r.useEffect)(()=>{let e=eL.get("url"),t=eL.get("apikey");if(e&&t){let a=decodeURIComponent(e),s=decodeURIComponent(t);W.setApiConfig(s,a)}let a=W.getApiConfig();if(a&&a.baseUrl&&a.baseUrl.startsWith("http:")){let e=a.baseUrl.replace("http:","https:");W.setApiConfig(a.key,e),console.log("API URL已自动升级到HTTPS:",e)}},[eL]),(0,r.useEffect)(()=>{W.getCustomModels().find(e=>e.value===x),v(ea.OPENAI)},[x]),(0,r.useEffect)(()=>{W.setLastSelectedModel(x)},[x]),(0,r.useEffect)(()=>{let e=e=>{let t=e.target;t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName)||eP(e)};return document.addEventListener("paste",e),()=>{document.removeEventListener("paste",e)}},[]);let eO=e=>{if(e.size>4194304)return void B("图片大小不能超过4MB");if(!["image/jpeg","image/png"].includes(e.type))return void B("只支持JPG和PNG格式的图片");let t=new FileReader;t.onload=e=>{var t;let a=null==(t=e.target)?void 0:t.result;es(e=>[...e,a]),B("")},t.readAsDataURL(e)},eP=e=>{var t;let a=null==(t=e.clipboardData)?void 0:t.items;a&&Array.from(a).forEach(e=>{if(e.type.startsWith("image/")){let t=e.getAsFile();t&&(eO(t),setTimeout(()=>{B("")},100))}})},eD=e=>{es(t=>t.filter((t,a)=>a!==e)),eb.current&&(eb.current.value="")},ez=e=>e.startsWith("data:image"),e_=async()=>{if(X&&0===ee.length)return void B("请先上传或选择图片");if(!u.trim())return void B("请输入提示词");B(null),I(!0),R([]),Y(""),H(0);try{let e="dall-e-3"===x||"gpt-image-1"===x||f===ea.DALLE,t=f===ea.GEMINI,a=u.trim();ee.length>1&&(a+="\n\n参考图片信息：上传了".concat(ee.length,"张参考图片，第一张作为主要参考，其他图片作为额外参考。"));let s=e||t?a:"".concat(a,"\n图片生成比例为：").concat(er);if(e)if(X){if(0===ee.length)throw Error("请先上传图片");try{let e=(await en.editDalleImage({prompt:s,model:x,modelType:f,sourceImage:ee[0],size:eo,n:ed,mask:eA||void 0,quality:em})).data.map(e=>{let t=e.url||e.b64_json;return t&&e.b64_json&&!ez(t)?"data:image/png;base64,".concat(t):t||""}).filter(e=>""!==e);R(e),e.length>0&&W.addToHistory({id:(0,el.A)(),prompt:s,url:e[0],model:x,createdAt:new Date().toISOString(),aspectRatio:"1:1"})}catch(e){e instanceof Error?B(e.message):B("生成图片失败，请重试")}}else try{let e=(await en.generateDalleImage({prompt:s,model:x,size:eo,n:ed,quality:em})).data.map(e=>{let t=e.url||e.b64_json;return t&&e.b64_json&&!ez(t)?"data:image/png;base64,".concat(t):t||""}).filter(e=>""!==e);R(e),e.length>0&&W.addToHistory({id:(0,el.A)(),prompt:s,url:e[0],model:x,createdAt:new Date().toISOString(),aspectRatio:"1:1"})}catch(e){e instanceof Error?B(e.message):B("生成图片失败，请重试")}else if(t)if(X){if(0===ee.length)throw Error("请先上传图片");try{let e=(await en.editGeminiImage({prompt:s,model:x,modelType:f,sourceImage:ee[0],size:eo,n:ed,mask:eA||void 0,quality:em})).data.map(e=>{let t=e.url||e.b64_json;return t&&e.b64_json&&!ez(t)?"data:image/png;base64,".concat(t):t||""}).filter(e=>""!==e);R(e),e.length>0&&W.addToHistory({id:(0,el.A)(),prompt:s,url:e[0],model:x,createdAt:new Date().toISOString(),aspectRatio:"1:1"})}catch(e){e instanceof Error?B(e.message):B("生成图片失败，请重试")}}else try{let e=(await en.generateGeminiImage({prompt:s,model:x,size:eo,n:ed,quality:em})).data.map(e=>{let t=e.url||e.b64_json;return t&&e.b64_json&&!ez(t)?"data:image/png;base64,".concat(t):t||""}).filter(e=>""!==e);R(e),e.length>0&&W.addToHistory({id:(0,el.A)(),prompt:s,url:e[0],model:x,createdAt:new Date().toISOString(),aspectRatio:"1:1"})}catch(e){e instanceof Error?B(e.message):B("生成图片失败，请重试")}else await en.generateStreamImage({prompt:s,model:x,modelType:f,sourceImage:X&&ee.length>0?ee[0]:void 0,sourceImages:X?ee:void 0,isImageToImage:X,aspectRatio:er},{onMessage:e=>{Y(t=>t+e),eg.current&&(eg.current.scrollTop=eg.current.scrollHeight)},onComplete:e=>{R([e]),W.addToHistory({id:(0,el.A)(),prompt:s,url:e,model:x,createdAt:new Date().toISOString(),aspectRatio:er})},onError:e=>{"object"==typeof e&&null!==e?B("图片生成失败: ".concat(e.message||"未知错误","\n").concat(e.code?"错误代码: ".concat(e.code):"")):B(e.toString())}})}catch(e){B(e instanceof Error?e.message:"生成失败，请重试")}finally{I(!1)}};return(0,s.jsxs)("main",{className:"min-h-screen bg-background",children:[(0,s.jsx)("div",{className:"w-full bg-blue-50 p-4 relative",children:(0,s.jsxs)("div",{className:"container mx-auto flex justify-center text-sm text-blue-700",children:[(0,s.jsx)(C.A,{className:"h-4 w-4 mr-2"}),(0,s.jsx)("p",{children:"数据安全提示：所有生成的图片和历史记录仅保存在本地浏览器中。请及时下载并备份重要图片。使用隐私模式或更换设备会导致数据丢失无法恢复。"})]})}),(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"AI绘画（最火香蕉模型）"}),(0,s.jsx)("p",{className:"text-gray-500 mt-2",children:"通过简单的文字描述，创造精美的AI艺术作品"})]}),(0,s.jsx)("div",{className:"container mx-auto px-4 pb-8 max-w-[1200px]",children:(0,s.jsxs)("div",{className:"grid grid-cols-[300px_1fr] gap-6",children:[(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsx)(o,{className:"sticky top-4",children:(0,s.jsxs)(d,{className:"p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)(h,{variant:"outline",size:"sm",onClick:()=>t(!0),children:[(0,s.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"密钥设置"]}),(0,s.jsxs)(h,{variant:"outline",size:"sm",onClick:()=>n(!0),children:[(0,s.jsx)(E.A,{className:"h-4 w-4 mr-2"}),"历史记录"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"font-medium",children:"生成模式"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)(h,{variant:X?"outline":"secondary",className:"w-full",onClick:()=>Z(!1),children:[(0,s.jsx)(k.A,{className:"h-4 w-4 mr-2"}),"文生图"]}),(0,s.jsxs)(h,{variant:X?"secondary":"outline",className:"w-full",onClick:()=>Z(!0),children:[(0,s.jsx)(L.A,{className:"h-4 w-4 mr-2"}),"图生图"]})]})]}),X&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"font-medium",children:"上传图片进行编辑"}),(0,s.jsx)("div",{className:"border-2 border-dashed rounded-lg p-4 text-center cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>{var e;return null==(e=eb.current)?void 0:e.click()},children:ee.length>0?(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[ee.map((e,t)=>(0,s.jsxs)("div",{className:"relative aspect-square w-full",children:[(0,s.jsx)(M.default,{src:e,alt:"Source ".concat(t+1),fill:!0,className:"object-contain rounded-lg"}),(0,s.jsx)(h,{variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full",onClick:e=>{e.stopPropagation(),eD(t)},children:"✕"})]},t)),ee.length<4&&(0,s.jsx)("div",{className:"flex items-center justify-center aspect-square w-full border-2 border-dashed rounded-lg",children:(0,s.jsx)(O.A,{className:"h-8 w-8 text-gray-400"})})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2 text-gray-500",children:[(0,s.jsx)(O.A,{className:"h-8 w-8"}),(0,s.jsx)("p",{children:"点击上传图片或拖拽图片到这里"}),(0,s.jsx)("p",{className:"text-xs text-purple-500 font-medium",children:"\uD83D\uDCA1 或直接粘贴截图（Ctrl+V / Cmd+V）"}),(0,s.jsx)("p",{className:"text-xs",children:"仅支持JPG、PNG格式，最大4MB"}),(0,s.jsx)("p",{className:"text-xs text-blue-500",children:"可上传多张图片作为参考（最多4张）"})]})}),(0,s.jsx)("input",{ref:eb,type:"file",accept:"image/jpeg,image/png",className:"hidden",onChange:e=>{let t=e.target.files;t&&t.length>0&&Array.from(t).forEach(eO)},multiple:!0})]}),X&&ee.length>0&&("dall-e-3"===x||"gpt-image-1"===x||f===ea.DALLE||"gemini-2.5-flash-imagen"===x||f===ea.GEMINI)&&(0,s.jsx)(h,{variant:"outline",className:"w-full",onClick:()=>{eS(!0),ek(ee[0])},children:eA?"重新编辑区域":"编辑图片区域"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"font-medium",children:"提示词"}),(0,s.jsx)(g,{placeholder:"描述你想要生成的图像，例如：一只可爱的猫咪，柔软的毛发，大眼睛，阳光下微笑...",className:"min-h-[120px]",value:u,onChange:e=>m(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"font-medium",children:"模型选择"}),(0,s.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,s.jsxs)(j,{value:W.getCustomModels().some(e=>e.value===x&&e.type===f)?"".concat(f,"::").concat(x):x,onValueChange:e=>{if("string"==typeof e&&e.includes("::")){let[t,a]=e.split("::");p(a),v(t)}else p(e)},children:[(0,s.jsx)(y,{className:"flex-1",children:(0,s.jsx)(b,{placeholder:"选择生成模型"})}),(0,s.jsxs)(w,{children:[(0,s.jsx)(N,{value:"gemini-2.5-flash-image-preview",children:"banana"}),(0,s.jsx)(N,{value:"gemini-2.5-flash-imagen",children:"gemini-nano-banana"}),(0,s.jsx)(N,{value:"gemini-2.5-pro-imagen",children:"gemini-nano-banana-pro"}),W.getCustomModels().length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N,{value:"divider",disabled:!0,children:"──── 自定义模型 ────"}),W.getCustomModels().map(e=>(0,s.jsxs)(N,{value:"".concat(e.type,"::").concat(e.value),children:[e.name," (",e.type===ea.DALLE?"DALL-E":e.type===ea.GEMINI?"Gemini":"OpenAI",")"]},e.id))]})]})]}),(0,s.jsx)(h,{variant:"outline",size:"icon",onClick:()=>i(!0),title:"管理自定义模型",children:(0,s.jsx)(S.A,{className:"h-4 w-4"})})]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["模型类型: ",f===ea.DALLE?"DALL-E格式":f===ea.GEMINI?"Gemini格式":"OpenAI格式"]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"选择不同的AI模型可能会产生不同风格的图像结果"})]}),("dall-e-3"===x||"gpt-image-1"===x||f===ea.DALLE||f===ea.GEMINI)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"font-medium",children:"图片尺寸"}),(0,s.jsxs)(j,{value:eo,onValueChange:e=>ec(e),children:[(0,s.jsx)(y,{children:(0,s.jsx)(b,{placeholder:"选择图片尺寸"})}),(0,s.jsxs)(w,{children:[(0,s.jsx)(N,{value:"1024x1024",children:"1024x1024 方形"}),(0,s.jsx)(N,{value:"1536x1024",children:"1536x1024 横向"}),(0,s.jsx)(N,{value:"1024x1536",children:"1024x1536 纵向"}),(0,s.jsx)(N,{value:"1792x1024",children:"1792x1024 宽屏"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"font-medium",children:"生成数量"}),(0,s.jsxs)(j,{value:ed.toString(),onValueChange:e=>eu(parseInt(e)),children:[(0,s.jsx)(y,{children:(0,s.jsx)(b,{placeholder:"选择生成数量"})}),(0,s.jsxs)(w,{children:[(0,s.jsx)(N,{value:"1",children:"1张"}),(0,s.jsx)(N,{value:"2",children:"2张"}),(0,s.jsx)(N,{value:"3",children:"3张"}),(0,s.jsx)(N,{value:"4",children:"4张"})]})]})]})]}),(0,s.jsx)(h,{className:"w-full",onClick:e_,disabled:A,children:A?"生成中...":X?"编辑图片":"生成图片"}),(0,s.jsx)(h,{variant:"outline",className:"w-full",onClick:()=>{m(""),R([]),B(null),Y(""),es([]),eI(null),ei("1:1"),ec("1024x1024"),eu(1),H(0)},children:"重置"})]})})}),(0,s.jsxs)(o,{className:"min-h-[calc(100vh-13rem)]",children:[(0,s.jsx)(c,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"生成结果"}),T.length>0&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(h,{size:"icon",variant:"ghost",onClick:()=>{if(T[G]){let e=T[G],t=document.createElement("a");t.href=e,ez(e)?t.download="generated-image-".concat(Date.now(),".png"):t.download="generated-image.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}},children:(0,s.jsx)(P.A,{className:"h-5 w-5"})}),(0,s.jsx)(h,{size:"icon",variant:"ghost",onClick:()=>{Z(!0),es([T[G]])},children:(0,s.jsx)(D.A,{className:"h-5 w-5"})})]})]})}),(0,s.jsx)(d,{className:"flex flex-col items-stretch justify-start p-6 h-full",children:V?(0,s.jsx)("div",{className:"text-center text-red-500 whitespace-pre-line",children:(0,s.jsx)("p",{children:V})}):(0,s.jsxs)("div",{className:"w-full h-full flex flex-col gap-4",children:["dall-e-3"===x||"gpt-image-1"===x||f===ea.DALLE?(0,s.jsx)("div",{className:"text-center text-gray-400",children:A?"正在生成中...":0===T.length?"等待生成...":null}):(0,s.jsx)("div",{ref:eg,className:"flex-1 overflow-y-auto rounded-lg bg-gray-50 p-4 font-mono text-sm min-h-[200px] markdown-content",children:K?(0,s.jsx)(ef.oz,{remarkPlugins:[ev.A],rehypePlugins:[ej.A],components:{a:e=>{let{node:t,...a}=e;return(0,s.jsx)("a",{target:"_blank",rel:"noopener noreferrer",...a})},code:e=>{let{node:t,className:a,children:r,...n}=e,l=/language-(\w+)/.exec(a||"");return l||a?(0,s.jsx)("pre",{className:"".concat(a||""),children:(0,s.jsx)("code",{className:l?"language-".concat(l[1]):"",...n,children:r})}):(0,s.jsx)("code",{className:a,...n,children:r})}},children:K}):(0,s.jsx)("div",{className:"text-gray-400 text-center",children:A?"正在生成中...":"等待生成..."})}),T.length>0&&(0,s.jsxs)("div",{className:"relative w-full aspect-square max-w-2xl mx-auto",children:[(0,s.jsx)(M.default,{src:T[G],alt:u,fill:!0,className:"object-contain rounded-lg"}),T.length>1&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h,{variant:"ghost",size:"icon",className:"absolute left-2 top-1/2 -translate-y-1/2 bg-white/50 hover:bg-white/80",onClick:()=>{H(e=>(e-1+T.length)%T.length)},children:(0,s.jsx)(z.A,{className:"h-6 w-6"})}),(0,s.jsx)(h,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 bg-white/50 hover:bg-white/80",onClick:()=>{H(e=>(e+1)%T.length)},children:(0,s.jsx)(_.A,{className:"h-6 w-6"})}),(0,s.jsxs)("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 bg-white/50 px-2 py-1 rounded-full text-sm",children:[G+1," / ",T.length]})]})]})]})})]})]})}),(0,s.jsx)($,{open:e,onOpenChange:t}),(0,s.jsx)(et,{open:a,onOpenChange:n,onEditImage:e=>{Z(!0),es([e])}}),(0,s.jsx)(ey,{open:l,onOpenChange:i,onSelectModel:(e,t)=>{p(e),v(t),Q.o.success("已选择自定义模型")}}),(0,s.jsx)(U,{open:F,onOpenChange:q,children:(0,s.jsx)(J,{className:"max-w-4xl",children:(0,s.jsx)("div",{className:"relative w-full aspect-square",children:(0,s.jsx)(M.default,{src:T[G],alt:u,fill:!0,className:"object-contain rounded-lg"})})})}),eC&&eE?(0,s.jsx)(ex,{imageUrl:eE,onMaskChange:e=>{eI(e),eS(!1)},onClose:()=>eS(!1),initialMask:eA||void 0}):null]})}},7432:(e,t,a)=>{Promise.resolve().then(a.bind(a,4204))}},e=>{var t=t=>e(e.s=t);e.O(0,[671,264,441,684,358],()=>t(7432)),_N_E=e.O()}]);